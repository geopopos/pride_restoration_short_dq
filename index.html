<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css"
    />

    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="https://d2avoc1xjbdrch.cloudfront.net/6.43.0/styles/desktop.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />

    <style type="text/css">
      .line .progresline {
        background-color: #ff4b4b !important;
      }
      .sec3 .textbox .box a, .sec3 .question4 .box button {
        background-color: #fe4b4b !important;
      }
      .sec3 .question4 .box .inputs input {
        border-bottom: 2px solid #fe4b4b !important;
      }

    </style>

    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '933693704546861');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=933693704546861&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
  </head>
  <body class="">
    <div class="line">
      <div class="progresline" style="width: 5%"></div>
      <div class="wrapper">
        <p>You're <span>5</span>% Complete</p>
      </div>
    </div>
    <div class="sec1">
      <div class="wrapper">
        <img src="img/logo.png" alt="" />
      </div>
    </div>
    <div class="sec2">
      <div class="wrapper">
        <h1>
          Get today's best prices on a New Roof! <br><br>
          <span>Take this Free 30-second Roofing Quiz to find out more and request a free estimate</span>
        </h1>
      </div>
    </div>
    <div class="sec3">
      <div class="wrapper">
        <div class="question_container">
          <div class="first_question">
            <div class="textbox question_three_answers">
              <h1>What is the Scope of This Project?</h1>
              <div class="box">
                <div class="arow"><img src="img/arow.png" alt="" /></div>
                <a href="">Replace Complete Roof</a>
                <a href="">New Construction</a>
                <a href="">Repair Existing Roof - Currently Leaking or Storm Damage</a>
              </div>
            </div>
          </div>
          <div class="credit_score_question" style="display: none;">
            <div class="textbox question_four_answers">
              <h1>What is your credit score?</h1>
              <div class="box">
                <div class="arow"><img src="img/arow.png" alt="" /></div>
                <a href="" class="disqualify">Poor (400-600)</a>
                <a href="">Fair (600-650)</a>
                <a href="">Good (650-720)</a>
                <a href="">Great (720+)</a>
              </div>
            </div>
          </div>
        </div>
        <div class="changable_popup">
          <div class="textbox question question4 question2 form_question">
            <h1>What's your full name?</h1>
            <div class="box">
              <form action="">
                <div class="inputs inputs_full_name">
                  <input type="text" name="" id="" placeholder="i.e. John" required />
                  <input type="text" name="" id="" placeholder="i.e. Smith" required />
                </div>
                <button class="isNotValid">NEXT</button>
              </form>
            </div>
          </div>
          <div class="textbox question question4 form_question">
            <h1>What is your email?</h1>
            <p>(Used only to send roofing information)</p>
            <div class="box">
              <form action="">
                <div class="inputs">
                  <input type="email" name="" id="" placeholder="i.e. johnsmith@gmail.com" required />
                </div>
                <button class="isNotValid">NEXT</button>
              </form>
            </div>
          </div>
          <div class="textbox question question4 form_question">
            <h1>Verify your current phone number?</h1>
            <p>(We'll only call to book your free roofing inspection)</p>
            <div class="box">
              <form action="">
                <div class="inputs">
                  <input type="text" class="phonenumber" name="" id="" placeholder="Your phone number" minlength="8"  required />
                </div>
                <button class="isNotValid">NEXT</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sec4">
      <div class="wrapper">
        <p>
          By filling this form, I authorize Roof Replacements of America and their associates to contact me by phone, email or text. <a href="">Privacy Policy</a>
        </p>
      </div>
    </div>
  </body>

  <script>


    var counter = 0;
    var numberofquesn = $(".sec3 .changable_popup .question").length + 2; // +2 for scope and credit score questions
    var questionArray = [];
    questionDict = {};
    var isDisqualified = false;

    function submitForm() {
      fetch('https://hooks.zapier.com/hooks/catch/5597682/3eb9o0g/', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
        },
        body: JSON.stringify(questionDict)
      })
      .then(response => response.json())
      .then(response => console.log(JSON.stringify(response)))
      .then(() => {
        if (isDisqualified) {
          window.location.href = "thankyou-dq.html";
        } else {
          window.location.href = "thankyou.html";
        }
      })
      .catch(error => {
        console.error('Error:', error);
        // Fallback redirection in case of error
        if (isDisqualified) {
          window.location.href = "thankyou-dq.html";
        } else {
          window.location.href = "thankyou.html";
        }
      });
    }

    function updateProgress() {
      var calculateprocents = Math.round((100 * counter) / numberofquesn);
      $(".line p span").html(calculateprocents);
      $(".line .progresline").css("width", calculateprocents+"%");
      if(calculateprocents > 50){
        $(".line .progresline").parent().addClass("white_c");
      }
    }

    function handleQuestionAnswer(question, answer) {
      counter += 1;
      questionDict[question] = answer;
      questionArray[counter] = answer;
      updateProgress();

      if(counter == numberofquesn){
        submitForm();
      }
    }

    $(".sec3 .question_container .box a").click(function(e) {
      e.preventDefault();

      var questionElement = $(this).closest('.textbox');
      var question = questionElement.find("h1").text().slice(0, -1);
      var answer = $(this).text();

      if (question === "What is your credit score?" && answer === "Poor (400-600)") {
        isDisqualified = true;
      }

      handleQuestionAnswer(question, answer);

      questionElement.parent().hide();
      
      if (questionElement.parent().hasClass('first_question')) {
        $(".credit_score_question").show();
      } else {
        $(".changable_popup .question:first").show();
      }

      $([document.documentElement, document.body]).animate({
        scrollTop: $(".sec3").offset().top - 70
      }, 500);

      if (counter === 1) {
        $("body").addClass("dark");
      }
    });

    $(".sec3 .changable_popup .box a").click(function(e) {
      e.preventDefault();

      var questionElement = $(this).closest('.question');
      var question = questionElement.find("h1").text().slice(0, -1);
      var answer = $(this).text();

      handleQuestionAnswer(question, answer);

      questionElement.hide();
      questionElement.next().show();
    });

    $( ".sec3 .question4 .box button" ).click(function(e) {
      e.preventDefault();
      if(!$(this).hasClass("isNotValid")){
        $(this).parent().parent().parent().css("display", "none");
        $(this).parent().parent().parent().next().css("display", "block");
        counter += 1;
        if($(this).parent().find(".inputs").hasClass("inputs_full_name")){
          var question_c = "Full Name"
          var answer = $(this).parent().find(".inputs input:nth-child(1)").val() + " " + $(this).parent().find(".inputs input:nth-child(2)").val();
        }else{
          question_c = $(this).parent().parent().parent().find("h1").text().slice(0,-1);
          answer = $(this).parent().find(".inputs input:nth-child(1)").val();
        }
        questionDict[question_c] = answer;
        questionArray[counter] = answer;
      }
      var calculateprocents = Math.round((100 * counter) / numberofquesn);
      $(".line p span").html(calculateprocents);
      $(".line .progresline").css("width", calculateprocents+"%");
      if(calculateprocents > 50){
        $(".line .progresline").parent().addClass("white_c");
      }


      if(counter == numberofquesn){
        var stringofelements = ""
        for(var i = 1 ; i < questionArray.length; i++){
          stringofelements += questionArray[i] + "\n"
        }
        submitForm();
      }
    });


$( ".sec3 .question4 .box .inputs input" ).on('input', function() {
  if ( $(this).parent().parent()[0].checkValidity() ) {
    $(this).parent().parent().find("button").removeClass("isNotValid");
  }else{
    $(this).parent().parent().find("button").addClass("isNotValid");
  }
});

$('.phonenumber').keypress
(
    function(event)
    {
        if (event.keyCode == 46 || event.keyCode == 8)
        {
        //do nothing
        }
        else 
        {
            if (event.keyCode < 48 || event.keyCode > 57 ) 
            {
			    event.preventDefault();	
			}	
        }
    }
);


  </script>
</html>
